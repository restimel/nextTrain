(function(t){function e(e){for(var r,i,s=e[0],u=e[1],c=e[2],d=0,l=[];d<s.length;d++)i=s[d],a[i]&&l.push(a[i][0]),a[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);f&&f(e);while(l.length)l.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(r=!1)}r&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},a={app:0},o=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var f=u;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("64a9"),a=n.n(r);a.a},"1de9":function(t,e,n){"use strict";var r=n("cda9"),a=n.n(r);a.a},"56d7":function(t,e,n){"use strict";n.r(e);var r=n("768b"),a=(n("386d"),n("28a5"),n("ac6a"),n("cadf"),n("551c"),n("f751"),n("097d"),n("2b0e")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),n("div",{attrs:{id:"nav"}},[n("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" |\n    "),n("router-link",{attrs:{to:"/configuration"}},[t._v("Config")]),t._v(" |\n    "),n("router-link",{attrs:{to:"/about"}},[t._v("About")])],1)],1)},i=[],s=(n("034f"),n("2877")),u={},c=Object(s["a"])(u,o,i,!1,null,null,null),f=c.exports,d=n("8c4f"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},t._l(t.departures,function(t){return n("Train",{key:t.display_informations.headsign,attrs:{departure:t}})}),1)},p=[],h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"departure",class:t.status},[n("div",{style:t.codeColor},[t._v(t._s(t.line))]),n("div",[t._v(t._s(t.direction))]),n("div",[t._v(t._s(t.displayTime))])])},m=[],v=n("0a0d"),b=n.n(v),g=(n("a481"),{name:"train",props:{departure:Object},data:function(){return{}},computed:{codeColor:function(){var t=this.departure.display_informations.color;return"color:#".concat(t)},line:function(){var t=this.departure.display_informations.commercial_mode,e=this.departure.display_informations.label;return"".concat(t," ").concat(e)},direction:function(){return this.departure.display_informations.direction},time:function(){var t=this.departure.stop_date_time.departure_date_time,e=t.replace(/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})/,"$1-$2-$3 $4:$5:$6"),n=new Date(e),r=Math.floor((n.getTime()-b()())/6e4);return r},displayTime:function(){return"".concat(this.time," min")},status:function(){var t=this.time;return t>0?"scheduled":0===t?"coming":"late"}}}),_=g,S=(n("8ec7"),Object(s["a"])(_,h,m,!1,null,"64c15bb0",null)),k=S.exports,x={name:"home",data:function(){return this.checkState(),{}},computed:{departures:function(){return this.$store.state.departures.slice(0,10)},fetchState:function(){return this.$store.state.fetchState}},methods:{update:function(){this.$store.dispatch("update")},goto:function(t){this.$router.push(t)},checkState:function(){"bad"===this.fetchState&&this.goto("/configuration")}},watch:{fetchState:function(){this.checkState()}},mount:function(){this.update()},components:{Train:k}},T=x,y=(n("1de9"),Object(s["a"])(T,l,p,!1,null,"3ab284a6",null)),$=y.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"about"},[n("h1",[t._v("Objectif")]),n("p",[t._v("Une page de test pour visualiser les horaires des trains d'une gare.")]),n("h1",[t._v("Information")]),n("p",[t._v("Version: "+t._s(t.version))]),n("p",[t._v("Auteur: Restimel - 28 / 04 / 2019")])])},C=[],O=n("9224"),j={name:"about",data:function(){return{version:O["a"]}}},P=j,I=Object(s["a"])(P,w,C,!1,null,null,null),A=I.exports,E=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"configuration"},[n("h1",[t._v("Configuration")]),n("div",{staticClass:"content"},[n("label",[t._v("\n            API token: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.token,expression:"token"}],domProps:{value:t.token},on:{input:function(e){e.target.composing||(t.token=e.target.value)}}})]),n("label",[t._v("\n            Id de gare: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.stationId,expression:"stationId"}],domProps:{value:t.stationId},on:{input:function(e){e.target.composing||(t.stationId=e.target.value)}}})]),n("label",[t._v("\n            Temps de rafraichissement: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.refreshTime,expression:"refreshTime"}],attrs:{type:"number",min:"1"},domProps:{value:t.refreshTime},on:{input:function(e){e.target.composing||(t.refreshTime=e.target.value)}}}),t._v("s\n        ")]),n("div",[n("button",{attrs:{disabled:!t.isConfValid},on:{click:t.update}},[t._v("\n                Test\n            ")]),t.isValid?n("button",{on:{click:t.toHome}},[t._v("\n                Home\n            ")]):n("button",{attrs:{disabled:""}},[t._v("\n                Configuration invalide\n            ")])]),n("div",{class:t.fetchState},[t._v("\n            "+t._s(t.statusText)+"\n        ")])])])},V=[],M={name:"configuration",data:function(){return{}},computed:{token:{get:function(){return this.$store.state.token},set:function(t){this.$store.commit("setConfiguration",{token:t})}},stationId:{get:function(){return this.$store.state.station},set:function(t){this.$store.commit("setConfiguration",{station:t})}},refreshTime:{get:function(){return this.$store.state.refreshTime/1e3},set:function(t){this.$store.commit("setConfiguration",{refreshTime:1e3*t})}},fetchState:function(){return this.$store.state.fetchState},statusText:function(){var t={good:"La configuration est bonne.",bad:"La configuration n'est pas correcte !",testing:"Test de la configuration en cours..."};return t[this.fetchState]},isConfValid:function(){var t=this.token&&this.stationId&&this.refreshTime>0;return!!t},isValid:function(){return this.isConfValid&&"good"===this.fetchState}},methods:{update:function(){this.$store.commit("setStatus",{fetchState:"testing"}),this.$store.dispatch("update")},toHome:function(){this.$router.push("/")}}},N=M,H=(n("7f17"),Object(s["a"])(N,E,V,!1,null,"7ca01530",null)),R=H.exports;a["a"].use(d["a"]);var U=new d["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:$},{path:"/about",name:"about",component:A},{path:"/configuration",name:"configuration",component:R}]}),z=(n("96cf"),n("3b8d")),D=n("2f62");a["a"].use(D["a"]);var J=0,L=new D["a"].Store({state:{departures:[],context:{timezone:"Europe/Paris",current_datetime:""},fetchState:"good",token:"",station:"",refreshTime:3e4},mutations:{setState:function(t,e){var n=e.departures,r=e.context;t.departures=n,t.context=r},setConfiguration:function(t,e){var n=e.token,r=e.station,a=e.refreshTime;n&&(t.token=n),r&&(t.station=r),a=+a,!isNaN(a)&&a>0&&(t.refreshTime=a)},setStatus:function(t,e){var n=e.fetchState;n&&(t.fetchState=n)}},actions:{update:function(){var t=Object(z["a"])(regeneratorRuntime.mark(function t(e){var n,r,a,o,i,s,u,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.commit,r=e.dispatch,a=e.state,o=a.token,i=a.station,!o||!i){t.next=19;break}return s="https://api.sncf.com/v1/coverage/sncf/stop_areas/stop_area%3AOCE%3ASA%3A87386417/departures",t.next=6,fetch(s,{credentials:"same-origin",headers:{"Content-Type":"text/plain",Authorization:"Basic "+btoa(o)}});case 6:if(u=t.sent,u.ok){t.next=11;break}return console.warn("Dat failed to be fetched"),n("setStatus",{fetchState:"bad"}),t.abrupt("return");case 11:return t.next=13,u.json();case 13:c=t.sent,n("setState",c),n("setStatus",{fetchState:"good"}),r("nextUpdate"),t.next=21;break;case 19:console.info("we cannot fetch data without token and station id"),n("setStatus",{fetchState:"bad"});case 21:case"end":return t.stop()}},t)}));function e(e){return t.apply(this,arguments)}return e}(),nextUpdate:function(t){var e=t.dispatch,n=t.state;clearTimeout(J);var r=n.refreshTime;J=setTimeout(function(){e("update")},r)}}});function B(){var t={};document.location.search.slice(1).split("&").forEach(function(e){var n=e.split("="),a=Object(r["a"])(n,2),o=a[0],i=a[1];t[o]=decodeURIComponent(i)}),L.commit("setConfiguration",t),L.dispatch("update")}a["a"].config.productionTip=!1,new a["a"]({router:U,store:L,render:function(t){return t(f)}}).$mount("#app"),B()},"64a9":function(t,e,n){},"761a":function(t,e,n){},"7f17":function(t,e,n){"use strict";var r=n("761a"),a=n.n(r);a.a},"8ec7":function(t,e,n){"use strict";var r=n("a30e"),a=n.n(r);a.a},9224:function(t){t.exports={a:"1.0.1"}},a30e:function(t,e,n){},cda9:function(t,e,n){}});
//# sourceMappingURL=app.61d9bb51.js.map