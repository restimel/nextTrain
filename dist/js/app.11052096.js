(function(t){function e(e){for(var a,o,s=e[0],c=e[1],u=e[2],f=0,d=[];f<s.length;f++)o=s[f],i[o]&&d.push(i[o][0]),i[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(d.length)d.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},i={app:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("64a9"),i=n.n(a);i.a},2060:function(t,e,n){"use strict";var a=n("be3d"),i=n.n(a);i.a},"56d7":function(t,e,n){"use strict";n.r(e);var a=n("768b"),i=(n("386d"),n("28a5"),n("ac6a"),n("cadf"),n("551c"),n("f751"),n("097d"),n("2b0e")),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),n("div",{attrs:{id:"nav"}},[n("router-link",{attrs:{to:"home"}},[t._v("Home")]),t._v(" |\n    "),n("router-link",{attrs:{to:"configuration"}},[t._v("Config")]),t._v(" |\n    "),n("router-link",{attrs:{to:"about"}},[t._v("About")])],1),t.showBanner?n("div",{attrs:{id:"information-banner"}},[t._v("\n      "+t._s(t.bannerText)+"\n  ")]):t._e()],1)},o=[],s={name:"App",computed:{isOnLine:function(){return this.$store.state.onLine},showBanner:function(){return!this.isOnLine},bannerText:function(){return this.isOnLine?"":"Offline mode: no internet connection"}}},c=s,u=(n("034f"),n("2877")),l=Object(u["a"])(c,r,o,!1,null,null,null),f=l.exports,d=n("8c4f"),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[t._l(t.departures,function(t){return n("Train",{key:t.display_informations.headsign,attrs:{departure:t}})}),0===t.departures.length?n("div",{staticClass:"banner-information"},[t._v("\n        Aucune ligne n'a été récupérées avec la configuration donnée.\n        "),n("router-link",{attrs:{to:"configuration"}},[t._v("Voir la configuration")])],1):t._e(),n("Clock",{staticClass:"clock"})],2)},m=[],h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"departure",class:t.status},[n("div",{style:t.codeColor},[t._v(t._s(t.line))]),n("div",[t._v(t._s(t.direction))]),n("div",[t._v(t._s(t.displayTime))])])},v=[],g=n("0a0d"),b=n.n(g),_=(n("a481"),{name:"train",props:{departure:Object},data:function(){return{}},computed:{codeColor:function(){var t=this.departure.display_informations.color;return"color:#".concat(t)},line:function(){var t=this.departure.display_informations.commercial_mode,e=this.departure.display_informations.label;return"".concat(t," ").concat(e)},direction:function(){return this.departure.display_informations.direction},time:function(){var t=this.departure.stop_date_time.departure_date_time,e=t.replace(/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})/,"$1-$2-$3 $4:$5:$6"),n=new Date(e),a=Math.floor((n.getTime()-b()())/6e4);return a},displayTime:function(){return"".concat(this.time," min")},status:function(){var t=this.time;return t>0?"scheduled":0===t?"coming":"late"}}}),k=_,T=(n("8ec7"),Object(u["a"])(k,h,v,!1,null,"64c15bb0",null)),x=T.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"clock",on:{click:t.update}},[t._v("\n    "+t._s(t.time)+"\n")])},y=[],$={name:"clock",data:function(){return setTimeout(this.updateTime.bind(this),0),{minutes:0,hours:0,timer:0}},computed:{time:function(){return"".concat(this.pad(this.hours),":").concat(this.pad(this.minutes))}},methods:{updateTime:function(){clearTimeout(this.timer);var t=new Date;this.hours=t.getHours(),this.minutes=t.getMinutes(),this.timer=setTimeout(this.updateTime.bind(this),1e4)},update:function(){this.$store.dispatch("update")},pad:function(t){return t>=10?t:"0".concat(t)}},deleted:function(){clearTimeout(this.timer)}},w=$,C=(n("2060"),Object(u["a"])(w,S,y,!1,null,"d360c2a6",null)),N=C.exports,O={name:"home",data:function(){return this.checkState(),{}},computed:{departures:function(){return this.$store.state.departures.slice(0,10)},fetchState:function(){return this.$store.state.fetchState}},methods:{update:function(){this.$store.dispatch("update")},goto:function(t){this.$router.push(t)},checkState:function(){"bad"===this.fetchState&&this.goto("configuration")}},watch:{fetchState:function(){this.checkState()}},mount:function(){this.update()},components:{Train:x,Clock:N}},j=O,I=(n("62d4"),Object(u["a"])(j,p,m,!1,null,"187cc93c",null)),L=I.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"about"},[n("h1",[t._v("Objectif")]),n("p",[t._v("Une page de test pour visualiser les horaires des trains d'une gare.")]),n("h1",[t._v("Information")]),n("p",[t._v("Version: "+t._s(t.version))]),n("p",[t._v("Auteur: Restimel - 28 / 04 / 2019")])])},U=[],A=n("9224"),E={name:"about",data:function(){return{version:A["a"]}}},M=E,V=Object(u["a"])(M,P,U,!1,null,null,null),z=V.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"configuration"},[n("h1",[t._v("Configuration")]),n("div",{staticClass:"content"},[n("label",{class:{isWrong:t.errors.has("apiName")}},[t._v("\n            API:\n            "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.apiName,expression:"apiName"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.apiName=e.target.multiple?n:n[0]}}},t._l(t.apiOptions,function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v("\n                    "+t._s(e.label)+"\n                ")])}),0)]),n("label",{class:{isWrong:t.errors.has("token")}},[t._v("\n            API token: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.token,expression:"token"}],domProps:{value:t.token},on:{input:function(e){e.target.composing||(t.token=e.target.value)}}})]),n("label",{class:{isWrong:t.errors.has("station")}},[t._v("\n            Id de gare: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.stationId,expression:"stationId"}],domProps:{value:t.stationId},on:{input:function(e){e.target.composing||(t.stationId=e.target.value)}}})]),n("label",{class:{isWrong:t.errors.has("distance")}},[t._v("\n            Distance à partir du lieu: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.distance,expression:"distance"}],attrs:{type:"range",min:"1",max:"10000"},domProps:{value:t.distance},on:{__r:function(e){t.distance=e.target.value}}}),t._v(" "+t._s(t.distanceLabel)+"\n        ")]),n("label",{class:{isWrong:t.errors.has("refreshTime")}},[t._v("\n            Temps de rafraichissement: "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.refreshTime,expression:"refreshTime"}],attrs:{type:"number",min:"1"},domProps:{value:t.refreshTime},on:{input:function(e){e.target.composing||(t.refreshTime=e.target.value)}}}),t._v("s\n        ")]),n("div",[n("button",{attrs:{disabled:!t.isConfValid},on:{click:t.update}},[t._v("\n                Test\n            ")]),t.isValid?n("button",{on:{click:t.toHome}},[t._v("\n                Home\n            ")]):n("button",{attrs:{disabled:""}},[t._v("\n                Configuration invalide\n            ")])]),n("div",{class:t.fetchState},[t._v("\n            "+t._s(t.statusText)+"\n        ")])])])},H=[],R=n("a4bb"),W=n.n(R),B=(n("6b54"),n("b6d0")),J=n.n(B),q={sncf:"https://%(token)s@api.sncf.com/v1/coverage/sncf/stop_areas/stop_area%(station)s/departures",stif:"https://opendata.stif.info/service/api-stif-horaires/coords/%(lng)s%3B%(lat)s/departures?count=%(nbItems)s&distance=%(distance)s&apikey=%(token)s"},F=new J.a;function G(t,e){return F.clear(),e||(e=q[t.apiName]),e.replace(/%\((\w+)\)s/g,function(e,n){var a=t[n];""!==a.toString()&&void 0!==a&&null!==a||F.add(n)}),!F.size}function K(t,e){var n=t.state,a=t.commit,i=n.cacheUrl;return i||(i=q[e],i&&G(n,i)?(i=i.replace(/%\((\w+)\)s/g,function(t,e){return encodeURIComponent(n[e])}),a&&a("setCacheUrl",i),i):"")}var Q={name:"configuration",data:function(){return{}},computed:{token:{get:function(){return this.$store.state.token},set:function(t){this.$store.commit("setConfiguration",{token:t})}},stationId:{get:function(){return this.$store.state.station},set:function(t){this.$store.commit("setConfiguration",{station:t})}},distance:{get:function(){return this.$store.state.distance},set:function(t){this.$store.commit("setConfiguration",{distance:t})}},refreshTime:{get:function(){return this.$store.state.refreshTime/1e3},set:function(t){this.$store.commit("setConfiguration",{refreshTime:1e3*t})}},apiName:{get:function(){return this.$store.state.apiName},set:function(t){this.$store.commit("setConfiguration",{apiName:t})}},fetchState:function(){return this.$store.state.fetchState},errors:function(){return F},statusText:function(){var t={good:"La configuration est bonne.",bad:"La configuration n'est pas correcte !",testing:"Test de la configuration en cours...",offline:"Aucune connexion internet pour tester la ligne..."};return t[this.fetchState]},isConfValid:function(){return!!K(this.$store,this.apiName)},isValid:function(){return this.isConfValid&&"good"===this.fetchState},apiOptions:function(){return W()(q).map(function(t){return{id:t,label:t}})},distanceLabel:function(){var t=this.distance;return t<1e3?"".concat(t,"m"):(t=Math.round(t/100)/10,"".concat(t,"km"))}},methods:{update:function(){this.$store.commit("setStatus",{fetchState:"testing"}),this.$store.dispatch("update")},toHome:function(){this.$router.push("home")}}},X=Q,Y=(n("8aa3"),Object(u["a"])(X,D,H,!1,null,"3d3e7850",null)),Z=Y.exports;i["a"].use(d["a"]);var tt=new d["a"]({mode:"hash",base:"/",routes:[{path:"*/home",name:"home",component:L,alias:"*/"},{path:"*/about",name:"about",component:z},{path:"*/configuration",name:"configuration",component:Z},{path:"*",name:"Default",redirect:"home"}]}),et=(n("6762"),n("2fdb"),n("96cf"),n("3b8d")),nt=n("f499"),at=n.n(nt),it=n("2f62");i["a"].use(it["a"]);var rt=0,ot=new it["a"].Store({state:{departures:[],context:{timezone:"Europe/Paris",current_datetime:""},token:"",station:"",distance:200,lat:48.937591,lng:2.157858,refreshTime:3e4,nbItems:10,apiName:"sncf",fetchState:"good",onLine:!0,cacheUrl:""},mutations:{setState:function(t,e){var n=e.departures,a=e.context;t.departures=n,t.context=a},setConfiguration:function(t,e){var n=e.token,a=e.station,i=e.distance,r=e.lat,o=e.lng,s=e.refreshTime,c=e.apiName,u=e.nbItems;"string"===typeof n&&(t.token=n),"string"===typeof a&&(t.station=a),"undefined"!==typeof i&&(i=+i,!isNaN(i)&&i>0?t.distance=i:t.distance=200),isNaN(r)||isNaN(o)?void 0===r&&void 0===o||(t.lat=0,t.lng=0):(t.lat=+r,t.lng=+o),"undefined"!==typeof s&&(s=+s,!isNaN(s)&&s>0?t.refreshTime=s:t.refreshTime=30),"undefined"!==typeof u&&(u=+u,!isNaN(u)&&u>0?t.nbItems=u:t.nbItems=10),"string"===typeof c&&(t.apiName=c,t.cacheUrl="");var l={token:t.token,station:t.station,distance:t.distance,lat:t.lat,lng:t.lng,refreshTime:t.refreshTime,nbItems:t.nbItems,apiName:t.apiName};localStorage.nextTrainConfig=at()(l)},setStatus:function(t,e){var n=e.fetchState,a=e.onLine;n&&(t.fetchState=n),"boolean"===typeof a&&(t.onLine=a)},setCacheUrl:function(t,e){t.cacheUrl=e}},actions:{initialize:function(t){var e=t.commit,n=t.dispatch;e("setStatus",{onLine:navigator.onLine}),navigator.connection&&(navigator.connection.onchange=function(){e("setStatus",{onLine:navigator.onLine})}),n("update")},update:function(){var t=Object(et["a"])(regeneratorRuntime.mark(function t(e){var n,a,i,r,o,s,c,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.commit,a=e.dispatch,i=e.state,i.onLine){t.next=5;break}return n("setStatus",{fetchState:"offline"}),a("nextUpdate"),t.abrupt("return");case 5:if(r=K({state:i,commit:n},i.apiName),!r){t.next=24;break}return o={"Content-Type":"text/plain"},r.includes("@")&&(r=r.replace(/(https?:\/\/)([^@]+)@/,function(t,e,n){return s=n,e}),o.Authorization="Basic "+btoa(s)),t.next=11,fetch(r,{credentials:"same-origin",headers:o}).catch(function(t){return console.warn("Error in request:",t.message),{ok:!1}});case 11:if(c=t.sent,c.ok){t.next=16;break}return console.warn("Data failed to be fetched"),n("setStatus",{fetchState:"bad"}),t.abrupt("return");case 16:return t.next=18,c.json();case 18:u=t.sent,n("setState",u),n("setStatus",{fetchState:"good"}),a("nextUpdate"),t.next=26;break;case 24:console.info("we cannot fetch data without token and station id"),n("setStatus",{fetchState:"bad"});case 26:case"end":return t.stop()}},t)}));function e(e){return t.apply(this,arguments)}return e}(),nextUpdate:function(t){var e=t.dispatch,n=t.state;clearTimeout(rt);var a=n.refreshTime;rt=setTimeout(function(){e("update")},a)}}});function st(){var t=JSON.parse(localStorage.nextTrainConfig||"{}");document.location.search.slice(1).split("&").forEach(function(e){var n=e.split("="),i=Object(a["a"])(n,2),r=i[0],o=i[1];t[r]=decodeURIComponent(o)}),ot.commit("setConfiguration",t),ot.dispatch("initialize")}i["a"].config.productionTip=!1,new i["a"]({router:tt,store:ot,render:function(t){return t(f)}}).$mount("#app"),st()},"62d4":function(t,e,n){"use strict";var a=n("8403"),i=n.n(a);i.a},"64a9":function(t,e,n){},8403:function(t,e,n){},"8aa3":function(t,e,n){"use strict";var a=n("bb9c"),i=n.n(a);i.a},"8ec7":function(t,e,n){"use strict";var a=n("a30e"),i=n.n(a);i.a},9224:function(t){t.exports={a:"1.0.4"}},a30e:function(t,e,n){},bb9c:function(t,e,n){},be3d:function(t,e,n){}});
//# sourceMappingURL=app.11052096.js.map